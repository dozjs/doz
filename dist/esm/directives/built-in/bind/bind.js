import index from"../../index.js";import delay from"../../../utils/delay.js";const{directive:directive}=index;directive("bind",{onAppComponentCreate(e){Object.defineProperties(e,{_boundElements:{value:{},writable:!0}})},onAppComponentUpdate(e,t){Object.keys(e._boundElements).length&&this.updateBoundElementsByChanges(e,t)},onAppComponentLoadProps(e){this.updateBoundElementsByPropsIteration(e)},onComponentDOMElementCreate(e,t,n,o){this.canBind(t)&&this.setBind(e,t,n)},canBind:e=>-1!==["INPUT","TEXTAREA","SELECT"].indexOf(e.nodeName),setBind(e,t,n){if(void 0===e.props[n])return;["compositionstart","compositionend","input","change"].forEach((function(o){t.addEventListener(o,(function(t){let o;if("checkbox"===this.type)if(this.defaultValue){o=[...e.appRoot.querySelectorAll(`input[name=${this.name}][type=checkbox]:checked`)].map((e=>e.value)),e.props[n]=o}else e.props[n]=this.checked;else o=this.value,this.multiple&&(o=[...this.options].filter((e=>e.selected)).map((e=>e.value))),e.props[n]=o}))})),void 0!==e._boundElements[n]?e._boundElements[n].push(t):e._boundElements[n]=[t],delay((()=>{this.updateBoundElement(t,e.props[n],e)}))},updateBoundElementsByChanges(e,t){t.forEach((t=>{let n=t.newValue,o=t.property;this.updateBoundElements(e,n,o)}))},updateBoundElementsByPropsIteration(e){let t=this;!function n(o){let s=Object.keys(o);for(let i=0,l=s.length;i<l;i++){let l=s[i];o[l]instanceof Object&&null!==o[l]?n(o[l]):t.updateBoundElements(e,o[l],l)}}(e._rawProps)},updateBoundElements(e,t,n){Object.prototype.hasOwnProperty.call(e._boundElements,n)&&e._boundElements[n].forEach((n=>{this.updateBoundElement(n,t,e)}))},updateBoundElement(e,t,n){if("checkbox"===e.type)if(e.defaultValue){if(Array.isArray(t)){[...n.appRoot.querySelectorAll(`input[name=${e.name}][type=checkbox]`)].forEach((e=>e.checked=t.includes(e.value)))}}else e.checked=t;else"radio"===e.type?e.checked=e.value===t:"select-multiple"===e.type&&Array.isArray(t)?[...e.options].forEach((e=>e.selected=t.includes(e.value))):e.value=t}});