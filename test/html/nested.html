<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Doz - nested</title>
    <script src="../../dist/doz.js?589654t888"></script>
    <style>
        body {
            font-family: sans-serif;
        }
        button {
            padding: 20px;
            font-size: 20px;
        }
    </style>
</head>
<body>
<div id="app"></div>

<script>

    Doz.component('x-cmp', {
        template(h) {
            return h`
                <div style="background: red; padding: 20px;">
                    hello
                </div>
            `
        }
    });

    Doz.component('x-cmp-2', {
        template(h) {
            return h`
                <div style="background: greenyellow; padding: 20px;">
                    world
                </div>
            `
        }
    });

    new Doz({
        root: '#app',
        props: {
            linkName: 'A link'
        },
        template(h) {
            return h`
                <x-cmp>
                    <a href="#" title="${this.props.linkName}">${this.props.linkName}</a>
                    <x-cmp-2>
                        ${this.props.linkName}
                    </x-cmp-2>
                </x-cmp>
                <button onclick="this.props.linkName = 'timestamp: ' + Date.now()">change link name</button>
            `;
        }
    }).on('draw', (next, prev, component) => {
        walkChildren(next);
        console.log(component.children[0].template(Doz.h));
        console.log(component.children[0].children[0].template(Doz.h));
        console.log(component.template(Doz.h));
        //console.log(component.getHTMLElement().firstChild.outerHTML);
        let nextCompiled = Doz.compile(component.getHTMLElement().firstChild.outerHTML);
        let prevCompiled = Doz.compile(component.getHTMLElement().firstChild.outerHTML);

        nextCompiled.children[0].children[2].children[0] = component.props.linkName;

        //console.log({...next});
        //console.log(compiledNext);

        Object.assign(next, nextCompiled);
        Object.assign(prev, prevCompiled);

    });

    function walkChildren(next) {
        // bisogna scorrere tutto next
        // identificare il tag type,
        // se è di tipo componente, allora devo cercare
        // l'istanza e chiamare "template" dopodichè
        // compilare e sostituire con questo compilato
    }

</script>
</body>
</html>