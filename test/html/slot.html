<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Doz - nested</title>
    <script src="../../dist/doz.js?589ifcrj5yn60f0f596ov34n8u888"></script>
    <!--script src="https://unpkg.com/doz/dist/doz.min.js"></script-->
    <style>
        body {
            font-family: sans-serif;
        }
        button {
            padding: 20px;
            font-size: 20px;
        }
    </style>
</head>
<body>
<div id="app"></div>

<script>

    Doz.component('x-cmp', {
        props: {
            time: '--:--:--'
        },
        template(h) {
            return h`
                <div style="background: red; padding: 20px;">
                    hello ${this.props.time}
                    <slot/>
                    <button onclick="console.log(this)">Info x-cmp</button>
                </div>
            `
        },

        onMount() {
            return;
            setInterval(() => {
                this.props.time = new Date().toLocaleTimeString()
            }, 1000);
        }
    });

    Doz.component('x-cmp-2', {
        props: {
            count: 0,
            label: 'the label'
        },
        propsListener: {
            count(v) {
                console.log(v);
            }
        },
        template(h) {
            return h`
                <div style="background: greenyellow; padding: 20px;">
                    ${this.props.label}
                    <slot/>
                    <button onclick="this.props.count++">Count</button> world and count ${this.props.count}
                    <button onclick="this.mountDivHello()">Mount div hello</button>
                    <button onclick="this.unmount()">Unmount</button>
                    <button onclick="console.log(this)">Info x-cmp-2</button>
                </div>
            `
        },
        mountDivHello() {
            this.mount('<div>Hello</div>')
        }
    });

    Doz.component('x-cmp-3', {
        template(h) {
            return h`
                <div style="padding: 10px; background: burlywood">
                    <div style="padding: 10px; background: lightseagreen">
                        <slot/>
                    </div>
                </div>
            `
        }
    });

    new Doz({
        root: '#app',
        props: {
            linkName: 'A link',
            label: 'test',
            records: ['hello', 'world']
        },
        propsListener: {
            linkName(v) {
                //console.log(v);
            }
        },
        onUpdate(changes) {
            //console.log(changes)
        },
        /*
                            ${this.each(this.props.records, i => `
                                <x-cmp-3 name="${i}">
                                    ${i}
                                </x-cmp-3>
                            `)}
        */
        //${this.each(this.props.records, i => h`<x-cmp-3 name="${i}">${i} <button onclick="console.log($this)">A button</button></x-cmp-3>`)}
        template(h) {
            return h`
                <x-cmp>
                    <div>
                        <a href="#" title="${this.props.linkName}">${this.props.linkName}</a>
                        <x-cmp-2 label="${this.props.label}">
                            <div style="background: #5063ff">Inner CMP2 label: ${this.props.label}</div>
                            ${this.each(this.props.records, (i, y) => h`
                                <x-cmp-3 name="${i}">
                                    ${i} <button forceupdate onclick="this.removeRecord(${y})">&times;</button>
                                </x-cmp-3>
                            `)}
                        </x-cmp-2>
                    </div>
                </x-cmp>

                <button onclick="this.props.linkName = 'timestamp: ' + Date.now()">change link name</button>
                <button onclick="this.props.label = 'timestamp: ' + Date.now()">change label</button>
                <button onclick="this.addRecords()">push records</button>
            `;
        },
        removeRecord(i) {
            //this.props.records[i] = Date.now();
            this.props.records.splice(i, 1);
            //console.log(this.template(Doz.h));
        },
        addRecords() {
            this.props.records.push('timestamp: ' + Date.now());
            //console.log(this.template(Doz.h))
        }
        /*onCreate() {
            this.app.on('draw', (next, old, cmp) => {
                console.log(next, old);
            })
        },
        onUpdate() {
            console.log(this);
        }*/
    });

</script>
</body>
</html>
